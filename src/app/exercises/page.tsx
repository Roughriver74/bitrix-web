'use client';

import Link from 'next/link';
import { useAuth } from '@/hooks/useAuth';
import { useEffect, useState } from 'react';
import MarkdownRenderer from '@/components/MarkdownRenderer';

export default function ExercisesPage() {
  const { user, loading } = useAuth();
  const [exercises, setExercises] = useState<string>('');
  const [loadingContent, setLoadingContent] = useState(true);

  useEffect(() => {
    if (user) {
      fetchExercises();
    }
  }, [user]);

  const fetchExercises = async () => {
    try {
      const exerciseContent = `
# Практические упражнения по Битрикс24

## Упражнение 1: Знакомство с интерфейсом

### Цель
Освоить основные элементы интерфейса Битрикс24 и научиться навигации

### Задания
1. Войдите в систему Битрикс24
2. Изучите главное меню и найдите следующие разделы:
   - Лента активности
   - Задачи и проекты
   - Календарь
   - Чаты и звонки
   - Диск
   - CRM
3. Настройте свой профиль:
   - Загрузите фотографию
   - Заполните контактную информацию
   - Настройте часовой пояс

### Результат
Вы должны уметь свободно перемещаться по интерфейсу системы

---

## Упражнение 2: Работа с задачами

### Цель
Научиться создавать и управлять задачами

### Задания
1. Создайте новую задачу:
   - Название: "Изучение модуля Задачи"
   - Описание: "Практическое задание по курсу"
   - Установите срок выполнения на завтра
   - Добавьте себя как исполнителя

2. Отредактируйте задачу:
   - Измените приоритет на "Высокий"
   - Добавьте метку "Обучение"
   - Прикрепите файл (любой)

3. Измените статус задачи на "Выполняется"

### Результат
Созданная и настроенная задача в системе

---

## Упражнение 3: Планирование в календаре

### Цель
Освоить создание событий и планирование

### Задания
1. Создайте встречу:
   - Название: "Планерка по проекту"
   - Дата: завтра, 10:00
   - Длительность: 1 час
   - Добавьте описание

2. Создайте повторяющееся событие:
   - Название: "Еженедельная планерка"
   - Каждый понедельник в 9:00
   - Длительность: 30 минут

3. Настройте напоминание за 15 минут до встречи

### Результат
Настроенный календарь с запланированными событиями

---

## Упражнение 4: Работа с чатами

### Цель
Освоить коммуникации в системе

### Задания
1. Создайте групповой чат:
   - Название: "Учебная группа"
   - Добавьте описание
   - Пригласите коллег (если есть)

2. Отправьте сообщения разных типов:
   - Текстовое сообщение
   - Файл
   - Изображение

3. Настройте уведомления для чата

### Результат
Созданный и настроенный групповой чат

---

## Упражнение 5: Работа с файлами

### Цель
Научиться работать с Битрикс24.Диск

### Задания
1. Создайте папку "Учебные материалы"
2. Загрузите несколько файлов:
   - Документ Word
   - Презентацию PowerPoint
   - Изображение

3. Настройте права доступа к папке
4. Поделитесь файлом с коллегой

### Результат
Организованная файловая структура с настроенными правами доступа

---

## Итоговое упражнение: Комплексный сценарий

### Цель
Применить все полученные знания в реальном сценарии

### Сценарий
Вы руководитель отдела и планируете внедрение новой системы документооборота

### Задания
1. Создайте проект "Внедрение системы документооборота"
2. Спланируйте встречу с командой для обсуждения проекта
3. Создайте групповой чат для координации работ
4. Создайте папку в Диске для проектных документов
5. Добавьте задачи:
   - Исследование решений (срок: 1 неделя)
   - Выбор системы (срок: 3 дня)
   - Подготовка технического задания (срок: 5 дней)
   - Согласование с руководством (срок: 2 дня)

6. Настройте уведомления и напоминания
7. Создайте отчет о ходе выполнения

### Результат
Полноценный рабочий процесс, организованный в Битрикс24

---

## Критерии оценки

### Отлично (5)
- Все упражнения выполнены без ошибок
- Использованы дополнительные функции системы
- Продемонстрировано понимание взаимосвязей между модулями

### Хорошо (4)
- Выполнены все основные задания
- Незначительные ошибки в настройках
- Базовое понимание функций системы

### Удовлетворительно (3)
- Выполнены основные задания
- Есть ошибки в настройках
- Требуется дополнительная практика

### Неудовлетворительно (2)
- Задания выполнены частично
- Многочисленные ошибки
- Необходимо повторное изучение материала

## Полезные ресурсы

- [Официальная документация Битрикс24](https://helpdesk.bitrix24.ru/)
- [Видеоуроки по Битрикс24](https://www.youtube.com/channel/UCLhObdHVj6HvdtT9EBkVIBQ)
- [Сообщество пользователей](https://community.bitrix24.ru/)
- [Блог Битрикс24](https://www.bitrix24.ru/blog/)

Удачи в изучении Битрикс24!
      `;
      
      setExercises(exerciseContent);
    } catch (error) {
      console.error('Ошибка загрузки упражнений:', error);
    } finally {
      setLoadingContent(false);
    }
  };

  if (loading || loadingContent) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 flex items-center justify-center">
        <div className="text-xl text-white">Загрузка...</div>
      </div>
    );
  }

  if (!user) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 flex items-center justify-center">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-white mb-4">Необходима авторизация</h2>
          <Link href="/" className="text-blue-400 hover:text-blue-300">
            Вернуться на главную
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800">
      <div className="container mx-auto px-4 py-8">
        <nav className="flex justify-between items-center mb-8">
          <Link href="/" className="text-blue-400 hover:text-blue-300">
            ← Назад к главной
          </Link>
          <div className="text-lg font-semibold text-white">
            Добро пожаловать, {user?.name}!
          </div>
        </nav>

        <div className="bg-gray-800 rounded-lg shadow-lg p-8 max-w-5xl mx-auto">
          <header className="text-center mb-8">
            <h1 className="text-4xl font-bold text-white mb-4">
              Практические упражнения
            </h1>
            <p className="text-xl text-gray-300">
              Закрепите полученные знания на практике
            </p>
          </header>

          <MarkdownRenderer content={exercises} />
          
          <div className="mt-8 pt-6 border-t text-center">
            <div className="flex justify-center space-x-4">
              <Link
                href="/modules"
                className="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors"
              >
                Изучить модули
              </Link>
              <Link
                href="/assessment"
                className="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors"
              >
                Пройти тестирование
              </Link>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}