# Руководство по деплою Битрикс24 курсов на Vercel

## Обзор изменений

Проект был полностью мигрирован с SQLite на PostgreSQL для совместимости с Vercel. Все API маршруты обновлены и добавлен расширенный контент по Битрикс24.

## Что исправлено

### ✅ Миграция базы данных
- Заменена SQLite на PostgreSQL с использованием @vercel/postgres
- Созданы все необходимые функции для работы с PostgreSQL
- Обновлены все API маршруты для работы с новой БД

### ✅ API маршруты (полностью мигрированы)
- `/api/init-db` - инициализация БД и загрузка контента
- `/api/courses` - работа с курсами ✅
- `/api/courses/[id]` - конкретный курс ✅
- `/api/courses/[id]/lessons` - уроки курса ✅
- `/api/lessons` - работа с уроками ✅
- `/api/lessons/[id]` - конкретный урок ✅
- `/api/tests` - работа с тестами ✅
- `/api/tests/[id]` - конкретный тест ✅
- `/api/test-questions` - вопросы тестов ✅
- `/api/test-questions/[id]` - конкретный вопрос ✅
- `/api/test-results` - результаты тестов ✅
- `/api/auth/me` - информация о пользователе ✅

### ✅ Новый контент
- 3 новых продвинутых курса по Битрикс24
- Детальные уроки по автоматизации, интеграциям и аналитике
- Тесты с вопросами по каждому курсу
- Более 15 000 слов нового контента

## Шаги для деплоя на Vercel

### 1. Настройка PostgreSQL базы данных

1. Перейдите в [Vercel Dashboard](https://vercel.com/dashboard)
2. Выберите ваш проект
3. Перейдите в **Storage** → **Create Database**
4. Выберите **Postgres**
5. Дайте название базе (например, `bitrix24-courses-db`)
6. Выберите регион (рекомендуется ближайший к вашим пользователям)

### 2. Настройка переменных окружения

После создания базы данных, Vercel предоставит вам переменные окружения. Добавьте их в настройки проекта:

1. Перейдите в **Settings** → **Environment Variables**
2. Добавьте следующие переменные:

```
POSTGRES_URL=postgresql://username:password@host:port/database
POSTGRES_PRISMA_URL=postgresql://username:password@host:port/database?pgbouncer=true&connect_timeout=15
POSTGRES_URL_NON_POOLING=postgresql://username:password@host:port/database
POSTGRES_USER=username
POSTGRES_HOST=host
POSTGRES_PASSWORD=password
POSTGRES_DATABASE=database
JWT_SECRET=your-strong-secret-key-here
```

**Важно:** Замените `your-strong-secret-key-here` на надежный секретный ключ для JWT.

### 3. Деплой приложения

1. Убедитесь, что все изменения закоммичены в Git
2. Отправьте изменения в репозиторий:
   ```bash
   git add .
   git commit -m "Migrate to PostgreSQL and add advanced Bitrix24 content"
   git push origin main
   ```

3. Vercel автоматически запустит деплой при обнаружении изменений

### 4. Инициализация базы данных

После успешного деплоя выполните инициализацию:

1. Перейдите по адресу: `https://your-domain.vercel.app/api/init-db?loadContent=true`
2. Используйте POST запрос (можно через Postman или curl):
   ```bash
   curl -X POST "https://your-domain.vercel.app/api/init-db?loadContent=true"
   ```

Это создаст все таблицы, добавит администраторов и загрузит весь контент курсов.

### 5. Проверка работоспособности

1. Откройте ваш сайт: `https://your-domain.vercel.app`
2. Войдите как администратор:
   - Email: `admin@bitrix24course.ru`
   - Пароль: `admin123`

   Или как основной администратор:
   - Email: `roughriver74@gmail.com`
   - Пароль: `bitrix2024`

3. Проверьте, что отображаются все курсы и контент

## Новые возможности

### Расширенные курсы по Битрикс24

1. **Продвинутая автоматизация Битрикс24**
   - Настройка роботов и триггеров
   - Маркетинговая автоматизация
   - Автоматизация проектов
   - Практические кейсы

2. **Интеграции и API Битрикс24**
   - REST API и разработка
   - Webhook и обмен данными
   - Интеграция с 1С, телефонией
   - Социальные сети и мессенджеры

3. **Аналитика и BI в Битрикс24**
   - CRM-аналитика и отчеты
   - Прогнозирование продаж
   - Интеграция с BI-системами
   - ABC-анализ клиентов

### Новые тесты
- 15 вопросов по автоматизации
- 15 вопросов по интеграциям
- 15 вопросов по аналитике
- Проверка знаний с правильными ответами

## Устранение проблем

### Если база данных не инициализируется:
1. Проверьте переменные окружения в Vercel
2. Убедитесь, что PostgreSQL база создана корректно
3. Проверьте логи в Vercel Dashboard → Functions

### Если не отображается контент:
1. Выполните POST запрос на `/api/init-db?loadContent=true`
2. Проверьте, что создались записи в таблице courses

### Ошибки авторизации:
1. Убедитесь, что JWT_SECRET установлен
2. Проверьте, что пользователи созданы в базе данных

## Мониторинг и обслуживание

### Логирование
- Все ошибки логируются в консоль Vercel
- Доступ к логам через Vercel Dashboard → Functions

### Бэкапы
- Vercel автоматически создает бэкапы PostgreSQL
- Дополнительно можно настроить регулярные экспорты данных

### Обновления
- При внесении изменений в код просто отправьте в Git
- Vercel автоматически пересоберет приложение

## Заключение

Проект полностью готов к деплою на Vercel с:
- ✅ PostgreSQL базой данных
- ✅ Всеми мигрированными API
- ✅ Расширенным контентом по Битрикс24
- ✅ Тестами и проверкой знаний
- ✅ Автоматической инициализацией

После выполнения всех шагов у вас будет полноценная платформа для изучения Битрикс24 с детальными курсами и тестированием.